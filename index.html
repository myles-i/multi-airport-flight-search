<!DOCTYPE html>
<html>

<head>
    <title>Fly For Myles and Myles</title>

    <!-- Expand the number of characters we can use in the document beyond basic ASCII ðŸŽ‰ -->
    <meta charset="utf-8">

    <!-- Connect Font Awesome CSS -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css">

    <!-- Connect Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">

    <!-- Connect Bootstrap JavaScript and its dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>

    <!-- Include jQuery -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

    <!-- Include Date Range Picker -->
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css" />


    <!-- Make it responsive to small screens -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Google web fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Passion+One:wght@700&display=swap" rel="stylesheet">

    <!-- connect custom sylesheets -->
    <!-- <link href="flight_search_page.css" rel="stylesheet"> -->



</head>

<body>
    <div class="view"
        style="background-image: url('https://www.ishn.com/ext/resources/900x550/airplane-plane-flight-900.jpg?1583412590'); height: 100%; background-repeat: no-repeat; background-size: cover; background-position: center center;">
        <div class="container h-100">
            <!-- add some spacing -->
            <div class="row mb-5">
            </div>
            <div class="row mb-2">
                <div class="col-md-12 text-center">
                    <h2>
                        Fly For Myles and Myles
                    </h2>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-12 text-center font-weight-bold">
                    <div>
                        A simple, multi-aiport search tool that includes Southwest results
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="offset-md-2 col-md-4 text-center">
                    <form>
                        <label class="text-center font-weight-bold" for="origin_input">
                            Origin
                        </label>
                        <input id="origin_input" class="form-control" type="text" placeholder="sfo, oak, sjc">
                    </form>
                </div>
                <div class="col-md-4 text-center">
                    <form>
                        <label class=" text-center font-weight-bold" for="destination_input">
                            Destination
                        </label>
                        <input id="destination_input" class="form-control" type="text" placeholder="lgb, sna">
                    </form>
                </div>
            </div>
            <div id="dates_row" class="row mt-2 align-items-center h-100">
                <div class="col-md-2 ">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" id="roundtrip_checkbox" type="checkbox" horizontal-align="middle" onclick="updateRoundtripState(this)">
                            Roundtrip
                        </input>
                    </div class="form-check">
                </div>
                <div class="col-md-4 text-center">
                    <form>
                        <label class="text-center font-weight-bold" for="departure_date_input">
                            Departure Date
                        </label>
                        <input class="form-control" id="departure_date_input" name="departure_date_input"
                            placeholder="yyyy-mm-dd" type="text">
                        </input>
                    </form>
                </div>
                <div class="col-md-4 text-center" id="return_date_input_column">
                    <form >
                        <label class="text-center font-weight-bold" for="return_date_input">
                            Return Date
                        </label>
                        <input class="form-control" id="return_date_input" name="return_date_input"
                            placeholder="yyyy-mm-dd" type="text">
                        </input>
                    </form>
                </div>
            </div>
            <div class="row mt-2 mb-5">
                <div class="offset-md-5 col-md-2 text-center margin-top:auto">
                    <button id="search_button" onclick="OpenSearchTabs()">
                        Search
                    </button>
                </div>
            </div>

            <!-- add some spacing (probably not the best way to do this) -->
            <div class="row mt-5 mb-5">
            </div>
            <div class="row mt-5 mb-5">
            </div>
            <div class="row mt-5 mb-5">
            </div>
            <div class="row mt-5 mb-5">
            </div>
            <!-- Info about site -->
            <div class="row mt-5 text-center font-weight-bold">
                <div class="col">
                    This tool opens new tabs with results from flights.google.com and southwest.com
                </div>
            </div>
            <div class="row mb-5 text-center font-weight-bold">
                <div class="col">
                    NOTE: you may need to disable pop-up blockers in your browser for proper function
                </div>
            </div>

            <!-- Link to github source -->
            <div class="row mb-5 text-center font-weight-bold">
                <div class="col ">
                    <a href="https://github.com/myles-i/multi-airport-flight-search">Created by Myles Alejandro Iribarne</a>
                </div>
            </div>
        </div>
    </div>

    <!-- datepicker scripts -->
    <script>
        function attachDatePickerFunctionality(tag_name)
        {
            $(document).ready(function () {

                var container = $('.bootstrap-iso form').length > 0 ? $('.bootstrap-iso form').parent() : "body";
                var options = {
                    format: 'yyyy-mm-dd',
                    container: container,
                    todayHighlight: true,
                    autoclose: true,
                    orientation: "bottom",
                }
                var departure_date = $('input[name="' + tag_name + '"]');
                departure_date.datepicker(options)
                departure_date.datepicker('update', new Date());
            })
        }
        attachDatePickerFunctionality("departure_date_input")

        return_date_element = document.getElementById("return_date_input_column");
        function updateRoundtripState(cb)
        {
            var dates_row_element = document.getElementById("dates_row");
            if (cb.checked)
            {
                dates_row_element.appendChild(return_date_element)
                attachDatePickerFunctionality("return_date_input")
            }
            else
            {
                dates_row_element.removeChild(return_date_element)

            }
        }

        // Initialize return date element to current state of "roundtrip checkbox"
        checkbox = document.getElementById('roundtrip_checkbox')
        updateRoundtripState(checkbox)

        function getAirports(tag) {
            elem = document.getElementById(tag)
            str = elem.value
            if (str.length == 0) {
                str = elem.getAttribute("placeholder")
            }
            return str.replace(/\s/g, '').toUpperCase().split(',')
        }

        function OpenSearchTabs() {

            destinations = getAirports("destination_input")
            origins = getAirports("origin_input")
            departure_date =  document.getElementById("departure_date_input").value
            is_roundrip_enabled = document.getElementById('roundtrip_checkbox').checked
            if (is_roundrip_enabled)
            {
                return_date = document.getElementById("return_date_input").value
            }
            for (dest_idx = 0; dest_idx < destinations.length; dest_idx++) {
                destination = destinations[dest_idx]
                for (origin_idx = 0; origin_idx < origins.length; origin_idx++) {
                    origin = origins[origin_idx]
                    // Open southwest search tab for each combination of origin/destination
                    if (is_roundrip_enabled)
                    {
                        url_str = "https://www.southwest.com/air/booking/select.html?adultPassengersCount=1&departureDate=" + departure_date +
                            "&departureTimeOfDay=ALL_DAY&destinationAirportCode=" + destination +
                            "&fareType=USD&int=HOMEQBOMAIR&originationAirportCode=" + origin +
                            "&passengerType=ADULT&reset=true&returnDate=" + return_date +
                            "&returnTimeOfDay=ALL_DAY&seniorPassengersCount=0&tripType=roundtrip"
                    }
                    else
                    {
                        url_str = "https://www.southwest.com/air/booking/select.html?int=HOMEQBOMAIR&adultPassengersCount=1&departureDate=" + departure_date +
                            "&destinationAirportCode=" + destination +
                            "&fareType=USD&originationAirportCode=" + origin +
                            "&passengerType=ADULT&returnDate=&seniorPassengersCount=0&tripType=oneway&departureTimeOfDay=ALL_DAY&reset=true&returnTimeOfDay=ALL_DAY"
                    }
                    window.open(url_str, "_blank");
                }
            }
            // open a single google flights page with all combos
            // roundtrip: https://www.google.com/flights?hl=en#flt=/m/0f04v,SFO,OAK,SJC.LGB,SNA.2020-07-12*LGB,SNA./m/0f04v,SFO,OAK,SJC.2020-07-16;c:USD;e:1;sd:1;t:f
            if (is_roundrip_enabled)
            {
                // url_str = "https://www.google.com/flights?hl=en#flt=/m/0f04v," + SFO,OAK,SJC.LGB,SNA.2020-07-12*LGB,SNA./m/0f04v,SFO,OAK,SJC.2020-07-16;c:USD;e:1;sd:1;t:f
                url_str = "https://www.google.com/flights#flt=/m/0f04v," + origins.join(',') + "." + destinations.join(',') + "." + departure_date +
                "*" + destinations.join(',') + "./m/0f04v," + origins.join(',') + "." + return_date + ";c:USD;e:1;sd:1;t:f"
            }
            else
            {
                url_str = "https://www.google.com/flights#flt=/m/0f04v," + origins.join(',') + "." + destinations.join(',') + "." + departure_date +
                    ";c:USD;e:1;sd:1;t:f;tt:o"
            }
            window.open(url_str, "_blank");
        }

    </script>
    </div>
</body>

</html>